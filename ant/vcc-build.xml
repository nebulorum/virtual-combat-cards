<?xml version="1.0" encoding="UTF-8"?>
<project name="VCC" default="dist" basedir="..">
	
  <property name="classpath"  value="bin"/>
  <property name="version" value="1.2-dev" />
  <property name="dist" value="dist" />
	<property name="package" value="${dist}/package" />
	<property name="deplib" value="${dist}/deplib" />
	<property name="installer" value="${dist}/installer" />
  <property name="vcc.jar" value="${installer}/lib/vcc.jar" />

	<fileset id="deplibs" dir="${deplib}">
		<include name="*.jar" />
		<exclude name="vccrun.jar"/>
	</fileset>

	<fileset id="readme" dir="ant">
		<include name="*LICENSE.txt" />
	</fileset>
	<target name="treestruct">
		<mkdir dir="${dist}"/>
  	<mkdir dir="${deplib}"/>
		<mkdir dir="${package}" />
		<mkdir dir="${package}/slib" />
		<mkdir dir="${installer}" />
  	<mkdir dir="${installer}/lib" />
  	<mkdir dir="${installer}/fs-wc" />
	</target>
	
	<target name="vccjar">
  	<jar jarfile="${vcc.jar}" 
  		basedir="${classpath}"
  		excludes="test/*"
  	/>
	</target>


	<target name="install-dir" depends="treestruct">
		<copy todir="${installer}/lib" file="ant/library.lst" />
		
  	<copy todir="${installer}/lib" verbose="true">
			<fileset refid="deplibs" />
		</copy>
		
		<copy todir="${installer}" verbose="true" file="ant/sample-comp.zip" />
		
		<copy todir="${installer}" verbose="true">
			<fileset refid="readme" />
		</copy>
		
  	<copy todir="${package}/slib" verbose="true">
  		<fileset dir="${deplib}" includes="log4j-1.2.15.jar" />
    </copy>
  	<copy todir="${installer}/fs-wc">
  	  <fileset dir="fs-wc"/>
  	</copy>
  </target>
  	
	<target name="installzip" depends="install-dir,vccjar">
  	<zip destfile="${package}/install.zip" basedir="${installer}" includes="**" />
	</target>

	<target name="patch-installzip" depends="install-dir,vccjar">
  	<zip destfile="${package}/install.zip" basedir="${installer}"><!-- -->
  		<include name="lib/vcc.jar" />
  	</zip>
	</target>
	
	
	<target name="packagezip" depends="installzip">
  	<copy todir="${package}">
  	  <fileset dir="scripts"/>
  		<fileset dir="${deplib}">
  			<filename name="vccrun.jar" />
  		</fileset>
  	</copy>
  	<zip destfile="${dist}/vcc-${version}.zip" basedir="${package}" includes="**">
  	</zip>
	</target>
	
	
	<target name="build" depends="packagezip">	
  </target>

  <target name="dist" depends="build">
	</target>
	
  <target name="dist-patch" depends="patch-installzip">
  	<zip destfile="${dist}/vcc-${version}.zip" basedir="${package}" includes="install.zip">
  	</zip>
	</target>
	
	<target name="clean">
  	<deltree dir="${dist}/installer"/>
  	<deltree dir="${dist}/package"/>
  </target>
</project>